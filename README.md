# 專案行事曆 - 任務顯示管理系統

## 專案概述

本專案是一個專案行事曆系統，用於管理與顯示多個環境的工作任務。系統以月曆形式呈現，支援階層式任務結構，並能同時顯示多個環境的並行工作項目。

## 核心功能

### 1. 月曆視圖顯示
- 採用月份為單位的行事曆格式
- 支援月份切換（上一個月/下一個月）
- 顯示當月所有日期
- 跨日期任務以橫條形式顯示

### 2. 階層式任務結構
- **第一階層**：環境名稱與目的
  - 環境名稱（例如：IT準備、資轉驗證環境、平測切轉環境等）
  - 環境目的（根據「環境名稱 + 執行梯次」決定）
- **第二階層**：對應的工作內容
  - 具體的工作項目
  - 工作描述與細節

### 3. 多環境並行顯示
- 同一時間可能有多個環境同時進行工作
- 不同環境使用不同顏色區分
- 清楚區分不同環境的任務

### 4. Excel 資料來源
- 從 `resource/範例_藍圖之對應時程環境規劃.xlsx` 讀取資料
- 解析 Excel 檔案中的環境與工作項目資訊
- 支援日期、環境、工作內容等欄位

### 5. 顯示設定功能
- 可自訂任務條上顯示的欄位
- 支援顯示：環境名稱、執行梯次、狀態、環境目的、營業日、工作內容、日期等
- 設定會自動保存到瀏覽器本地儲存

### 6. 環境篩選功能
- 可選擇顯示特定環境
- 支援「全部顯示」選項
- 月份切換時保持篩選狀態

## 資料結構規格

### Excel 檔案預期格式

Excel 檔案應包含以下欄位（欄位名稱可包含關鍵字）：

| 欄位名稱 | 說明 | 必填 | 關鍵字範例 |
|---------|------|------|-----------|
| 環境名稱 | 第一階層：環境識別名稱 | ✅ | 環境、環境名稱、環境名 |
| 環境目的 | 第一階層：該環境的用途說明 | ⚠️ | 目的、環境目的、用途 |
| 執行梯次 | 執行批次或階段 | ❌ | 梯次、執行梯次、批次 |
| 工作內容 | 第二階層：具體工作項目 | ✅ | 工作、工作內容、任務 |
| 驗證起日 | 工作項目的開始日期 | ✅ | 開始、開始日期、驗證起日 |
| 驗證迄日 | 工作項目的結束日期 | ⚠️ | 結束、結束日期、驗證迄日 |
| 狀態 | 工作項目狀態 | ❌ | 狀態、進度、完成狀態 |
| 營業日 | 營業日期 | ❌ | 營業日、營業日期 |
| 資料基準日 | 資料基準日期 | ❌ | 資料基準日、基準日 |
| 京城封版日 | 京城封版日期 | ❌ | 京城封版日、封版日 |
| 京城傳送中介檔日 | 京城傳送中介檔日期 | ❌ | 京城傳送中介檔日、傳送日 |
| 中介檔 | 中介檔案名稱 | ❌ | 中介檔、中介檔案 |
| 備注說明 | 備注或說明文字 | ❌ | 備注說明、備註說明 |

**重要說明**：
- 環境目的會根據「環境名稱 + 執行梯次」來決定，同一環境的不同梯次可以有不同的目的
- 如果「驗證迄日」為空，系統會使用「驗證起日」作為結束日期
- 如果「環境目的」為空，系統會設為「未指定目的」

### 資料階層關係

```
環境（第一階層）
├── 環境名稱
├── 環境目的（根據「環境名稱 + 執行梯次」決定）
└── 工作項目（第二階層）
    ├── 執行梯次
    ├── 狀態
    ├── 工作內容 1
    ├── 工作內容 2
    └── ...
```

## UI/UX 功能

### 視覺呈現

1. **月曆版面**
   - 採用標準月曆網格布局（7 天 × 週數）
   - 每個日期格子可容納多個任務項目
   - 清楚標示今天日期

2. **多環境區分**
   - **顏色編碼**：不同環境使用不同顏色標識
   - **視覺層次**：
     - 第一階層（環境）使用較粗的邊框或背景色塊
     - 第二階層（工作內容）使用較細的邊框或標籤樣式
   - **分組顯示**：同一環境的任務項目視覺上聚集在一起

3. **任務條顯示**
   - 可自訂顯示的欄位（環境名稱、執行梯次、狀態、環境目的等）
   - 不同欄位使用不同顏色的標籤顯示
   - 支援跨日期任務條顯示

### 互動功能

1. **月份切換**：使用「上個月」/「下個月」按鈕
2. **任務詳情**：點擊日期或任務項目查看完整資訊
3. **環境篩選**：使用頂部的環境篩選按鈕
4. **顯示設定**：點擊「顯示設定」按鈕自訂任務條顯示欄位
5. **清除快取**：點擊「清除快取」按鈕清除瀏覽器快取並重新載入

## 技術規格

### 技術棧

- **前端**：HTML5 + CSS3 + JavaScript（原生，無框架）
- **Excel 解析**：使用 `xlsx` JavaScript 函式庫（CDN）
- **月曆元件**：自行實作的客製化月曆元件

### 檔案結構

```
project_calendar/
├── README.md                  # 本文件
├── CONFIG_GUIDE.md            # 配置指南
├── EXCEL_FORMAT.md            # Excel 格式說明
├── USAGE.md                   # 使用說明
├── index.html                 # 主頁面
├── css/
│   └── calendar.css           # 月曆樣式
├── js/
│   ├── config.js              # 系統配置
│   ├── excel-reader.js        # Excel 讀取邏輯
│   ├── data-processor.js      # 資料處理邏輯
│   ├── calendar.js            # 月曆渲染邏輯
│   ├── settings-panel.js      # 顯示設定面板邏輯
│   └── main.js                # 主程式
└── resource/
    └── 範例_藍圖之對應時程環境規劃.xlsx
```

### 資料處理流程

1. **讀取 Excel**
   - 載入 `resource/範例_藍圖之對應時程環境規劃.xlsx`
   - 解析工作表內容

2. **資料轉換**
   - 將 Excel 資料轉換為 JSON 格式
   - 根據「環境名稱 + 執行梯次」決定環境目的
   - 建立環境與工作項目的階層關係
   - 按日期分組整理

3. **月曆渲染**
   - 根據當前月份生成月曆網格
   - 將任務項目對應到對應日期
   - 套用視覺樣式（顏色、階層標示）

4. **互動處理**
   - 處理月份切換事件
   - 處理任務點擊事件
   - 處理環境篩選事件
   - 處理顯示設定事件

## 快速開始

### 啟動方式

1. 安裝 Node.js（如果尚未安裝）
2. 在專案目錄下執行：
```bash
npx http-server . -p 8080 -o
```
3. 瀏覽器會自動開啟，或手動訪問 `http://localhost:8080`

### 使用說明

詳細使用說明請參考 `USAGE.md`

### 配置說明

系統配置檔案為 `js/config.js`，詳細配置說明請參考 `CONFIG_GUIDE.md`

### Excel 格式說明

Excel 檔案格式要求請參考 `EXCEL_FORMAT.md`

## 版本號管理

版本號直接在 HTML 中手動設置，修改 `index.html` 中的 `?v=xx` 參數即可：

```html
<script src="js/config.js?v=5"></script>
<script src="js/main.js?v=30"></script>
```

需要更新版本號時，直接修改 HTML 中的版本號參數，然後點擊「清除快取」按鈕重新載入。

## 注意事項

1. **Excel 檔案格式**：需確認 Excel 檔案的實際欄位結構，可能需要調整解析邏輯
2. **日期格式**：支援多種日期格式（Excel 日期序列號、YYYY-MM-DD、YYYY/MM/DD 等）
3. **瀏覽器相容性**：建議使用現代瀏覽器（Chrome、Firefox、Edge、Safari）
4. **資料更新**：當 Excel 檔案更新時，點擊「重新讀取」按鈕重新載入資料
5. **環境目的**：環境目的會根據「環境名稱 + 執行梯次」來決定，同一環境的不同梯次可以有不同的目的

## 相關文件

- `CONFIG_GUIDE.md` - 系統配置指南
- `EXCEL_FORMAT.md` - Excel 檔案格式說明
- `USAGE.md` - 使用說明
