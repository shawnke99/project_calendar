<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¡ˆè¡Œäº‹æ›† - ä»»å‹™é¡¯ç¤ºç®¡ç†</title>
    <link rel="stylesheet" href="css/calendar.css?v=2">
    <!-- æ¸…é™¤ JavaScript æ–‡ä»¶å¿«å–çš„å…§è¯è…³æœ¬ï¼ˆå¿…é ˆåœ¨æ‰€æœ‰ script æ¨™ç±¤ä¹‹å‰åŸ·è¡Œï¼‰ -->
    <script>
        (function() {
            // æª¢æŸ¥ URL åƒæ•¸ä¸­æ˜¯å¦æœ‰ nocache
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('nocache')) {
                const timestamp = urlParams.get('nocache');
                
                // ç«‹å³ç§»é™¤ URL åƒæ•¸ï¼ˆé¿å…é‡æ–°è¼‰å…¥æ™‚å†æ¬¡è§¸ç™¼ï¼‰
                const cleanUrl = window.location.pathname + (window.location.hash || '');
                window.history.replaceState({}, '', cleanUrl);
                
                // æ›´æ–°æ‰€æœ‰ script æ¨™ç±¤çš„ç‰ˆæœ¬è™Ÿ
                const scripts = document.querySelectorAll('script[src]');
                let needsReload = false;
                
                scripts.forEach(function(script) {
                    const src = script.getAttribute('src');
                    if (src && !src.includes('cdnjs.cloudflare.com')) {
                        // åªæ›´æ–°æœ¬åœ°æ–‡ä»¶ï¼Œä¸æ›´æ–° CDN æ–‡ä»¶
                        try {
                            const url = new URL(src, window.location.origin);
                            const currentVersion = url.searchParams.get('v');
                            // å¦‚æœç‰ˆæœ¬è™Ÿä¸åŒï¼Œæ›´æ–°å®ƒ
                            if (currentVersion !== timestamp) {
                                url.searchParams.set('v', timestamp);
                                script.src = url.pathname + '?' + url.searchParams.toString();
                                needsReload = true;
                                console.log('å·²æ›´æ–° script ç‰ˆæœ¬è™Ÿ:', script.src);
                            }
                        } catch (e) {
                            // å¦‚æœ URL è§£æå¤±æ•—ï¼Œå˜—è©¦ç°¡å–®çš„å­—ä¸²æ›¿æ›
                            if (!src.includes('v=' + timestamp)) {
                                const separator = src.includes('?') ? '&' : '?';
                                const newSrc = src.replace(/[?&]v=\d+/, '') + separator + 'v=' + timestamp;
                                script.src = newSrc;
                                needsReload = true;
                                console.log('å·²æ›´æ–° script ç‰ˆæœ¬è™Ÿ (å­—ä¸²æ›¿æ›):', script.src);
                            }
                        }
                    }
                });
                
                if (needsReload) {
                    console.log('å·²æ›´æ–°æ‰€æœ‰ JavaScript æ–‡ä»¶ï¼ˆåŒ…æ‹¬ config.jsï¼‰ç‰ˆæœ¬è™Ÿï¼Œé‡æ–°è¼‰å…¥é é¢ä»¥æ¸…é™¤å¿«å–...');
                    // å¼·åˆ¶é‡æ–°è¼‰å…¥ï¼ˆä¸ä½¿ç”¨å¿«å–ï¼‰ï¼Œæ­¤æ™‚ URL å·²ç¶“æ²’æœ‰ nocache åƒæ•¸
                    setTimeout(function() {
                        window.location.reload(true);
                    }, 50);
                } else {
                    console.log('æ‰€æœ‰ JavaScript æ–‡ä»¶ç‰ˆæœ¬è™Ÿå·²æ˜¯æœ€æ–°ï¼Œç„¡éœ€é‡æ–°è¼‰å…¥');
                }
            }
        })();
    </script>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œåˆ— -->
        <header class="header">
            <h1>å°ˆæ¡ˆè¡Œäº‹æ›†</h1>
            <div class="header-controls">
                <button id="prevMonth" class="btn btn-secondary">â—€ ä¸Šå€‹æœˆ</button>
                <span id="currentMonth" class="month-display">2024å¹´1æœˆ</span>
                <button id="nextMonth" class="btn btn-secondary">ä¸‹å€‹æœˆ â–¶</button>
                <button id="reloadExcel" class="btn btn-reload" title="é‡æ–°è®€å– Excel æª”æ¡ˆ">ğŸ“„ é‡æ–°è®€å–</button>
                <button id="clearCache" class="btn btn-cache" title="æ¸…é™¤å¿«å–ä¸¦é‡æ–°è¼‰å…¥">ğŸ”„ æ¸…é™¤å¿«å–</button>
            </div>
        </header>

        <!-- ç’°å¢ƒç¯©é¸å™¨ -->
        <div class="filter-section">
            <h3>ç’°å¢ƒç¯©é¸</h3>
            <div id="environmentFilters" class="filter-buttons">
                <button class="filter-btn active" data-env="all">å…¨éƒ¨é¡¯ç¤º</button>
            </div>
        </div>

        <!-- æœˆæ›†ä¸»é«” -->
        <div class="calendar-wrapper">
            <div class="calendar-header">
                <div class="day-header">æ—¥</div>
                <div class="day-header">ä¸€</div>
                <div class="day-header">äºŒ</div>
                <div class="day-header">ä¸‰</div>
                <div class="day-header">å››</div>
                <div class="day-header">äº”</div>
                <div class="day-header">å…­</div>
            </div>
            <div id="calendarGrid" class="calendar-grid"></div>
        </div>

        <!-- éå·¥ä½œæ—¥èªªæ˜ -->
        <div class="non-working-days-section">
            <h3 class="non-working-days-title">
                <span class="non-working-days-icon">ğŸ“…</span>
                éå·¥ä½œæ—¥èªªæ˜
            </h3>
            <div id="nonWorkingDaysInfo" class="non-working-days-items"></div>
        </div>

        <!-- åœ–ä¾‹ -->
        <div class="legend-section">
            <h3 class="legend-title">
                <span class="legend-icon">ğŸ“‹</span>
                åœ–ä¾‹èªªæ˜
            </h3>
            <div id="legend" class="legend-items"></div>
        </div>

        <!-- è¼‰å…¥ç‹€æ…‹ -->
        <div id="loadingIndicator" class="loading">
            <div class="spinner"></div>
            <p>è¼‰å…¥ä¸­...</p>
        </div>

        <!-- éŒ¯èª¤è¨Šæ¯ -->
        <div id="errorMessage" class="error-message" style="display: none;"></div>
    </div>

    <!-- ä»»å‹™è©³æƒ…å½ˆçª— -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">ä»»å‹™è©³æƒ…</h2>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- å¼•å…¥å‡½å¼åº« -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- å¼•å…¥é…ç½®æª”æ¡ˆï¼ˆå¿…é ˆæœ€å…ˆè¼‰å…¥ï¼‰ -->
    <script src="js/config.js?v=2"></script>
    <!-- å¼•å…¥è‡ªè¨‚æ¨¡çµ„ -->
    <script src="js/excel-reader.js?v=30"></script>
    <script src="js/data-processor.js?v=30"></script>
    <script src="js/calendar.js?v=30"></script>
    <script src="js/main.js?v=29"></script>
</body>
</html>

